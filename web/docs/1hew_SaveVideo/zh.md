# Save Video - 保存视频到磁盘并写入元数据

**节点功能：** `Save Video` 将 VIDEO 输入保存到 ComfyUI 输出目录或临时目录，并返回保存后的绝对文件路径。支持将 prompt/workflow 元数据写入容器的 `comment` 字段；当源视频包含透明通道时，可在临时目录生成 WEBM 预览用于 UI 播放。

## 输入

| 参数名称 | 入端选择 | 数据类型 | 默认值 | 取值范围 | 描述 |
| -------- | -------- | -------- | ------ | -------- | ---- |
| `video` | 可选 | VIDEO | - | - | 要保存的视频；输入为空时节点输出空结果。 |
| `filename_prefix` | - | STRING | `video/ComfyUI` | - | 保存文件前缀，交由 ComfyUI 路径生成处理；通常支持日期占位符（如 `%date:yyyy-MM-dd%`）。 |
| `save_output` | - | BOOLEAN | `true` | - | 开启时保存到输出目录；未开启时保存到临时目录。 |
| `save_metadata` | - | BOOLEAN | `true` | - | 开启时将 prompt/workflow 元数据写入容器 `comment` 字段。 |

## 输出

| 输出名称 | 数据类型 | 描述 |
|---------|----------|------|
| `file_path` | STRING | 保存后视频文件的绝对路径。 |

## 功能说明

- 输出位置控制：通过 `save_output` 选择输出目录或临时目录。
- 扩展名推导：在可获取源文件扩展名时，保存文件采用源扩展名。
- 元数据封装：通过 `ffmpeg` 对媒体进行 remux，将元数据写入 `comment`
  字段并保持流拷贝。
- 透明预览：通过 `ffprobe` 检测透明通道，生成 WEBM 预览到临时目录便于
  UI 播放查看。
- 界面预览：在 UI 面板展示 Preview Video 入口。

## 典型用法

- 保存上游处理后的成品视频到输出目录便于归档。
- 开启元数据写入，将生成参数随结果一并保存。
- 透明视频流程中使用预览文件快速检查透明效果。

## 注意与建议

- 节点调用 `ffprobe` 进行透明/音频探测，调用 `ffmpeg` 完成 remux 与预览生成。
- 节点对路径分配过程做串行化处理，计数器更稳定。
