# Image Batch Extract - 批量帧选择（索引/步长/均匀）

**节点功能：** `Image Batch Extract` 用于从输入图像批次中选择指定帧，支持三种模式：自定义索引列表、固定步长抽取与全局均匀采样。支持负索引、大批次分块选取，并可通过 `max_keep` 限制输出数量。

## 输入

| 参数名称 | 入端选择 | 数据类型 | 默认值 | 取值范围 | 描述 |
| -------- | -------- | -------- | ------ | -------- | ---- |
| `image` | 可选 | IMAGE | - | - | 输入图像批次 |
| `mode` | - | COMBO | `step` | `index` / `step` / `uniform` | 选择模式 |
| `index` | - | STRING | `0` | 逗号列表 | `index` 模式下的索引列表；支持负索引（如 `-1`） |
| `step` | - | INT | 4 | 1-8192 | `step` 模式下的步长；每隔 `step` 取一帧 |
| `uniform` | - | INT | 4 | 0-8192 | `uniform` 模式下的均匀采样数量；`0` 表示不取 |
| `max_keep` | - | INT | 10 | 0-8192 | 限制最大保留数量；`0` 表示保留全部 |

## 输出

| 输出名称 | 数据类型 | 描述 |
|---------|----------|------|
| `image` | IMAGE | 仅包含选择后帧的图像批次 |

## 功能说明

- 索引解析：兼容中/英文逗号；负索引将按批次长度转换为正索引。
- 步长抽取：从 0 开始按固定步长选择帧。
- 均匀采样：在 `[0, batch_size-1]` 范围内均匀选取指定数量。
- 健壮过滤：跳过无效索引；当无有效索引时输出为空批次（dtype/device 统一）。
- 分块选取：按 `512` 大小分块选择，降低大批次下的峰值内存占用。

## 典型用法

- 每 N 帧保留一帧：设置 `mode=step`、`step=N`。
- 生成均匀缩略图：设置 `mode=uniform`、`uniform=K` 均匀采样 K 帧。
- 自定义列表：设置 `mode=index`、`index=0, 2, 10, -1`，包含最后一帧。

## 注意与建议

- `max_keep=0` 表示不限制；设置为 `>0` 时将对输出数量进行上限裁剪。
- 若全部索引超出范围，输出为空批次但保持与输入一致的类型与设备。