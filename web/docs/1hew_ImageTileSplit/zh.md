# Image Tile Split - 图像分块分割

**节点功能：** `Image Tile Split` 节点用于将大图按照多种模式分割为小块（Tile），支持重叠、自定义网格和预设分辨率。通过处理重叠和精确位置计算，确保分割后的图像可以无缝重建。

## 输入

| 参数名称 | 入端选择 | 数据类型 | 默认值 | 取值范围 | 描述 |
| -------- | -------- | -------- | ------ | -------- | ---- |
| `image` | 必选 | IMAGE | - | - | 需要被分割的输入图像。 |
| `get_tile_size` | 可选 | IMAGE | - | - | 参考图像；若连接，则使用其尺寸作为分块尺寸（覆盖 `mode` 设置）。 |
| `mode` | - | COMBO | `auto` | `auto` / `grid` / 预设列表... | 分割模式。`auto` 自动计算最优网格；`grid` 使用手动行列数；预设模式使用固定分辨率。 |
| `overlap_amount` | - | FLOAT | 0.05 | 0.0-512.0 | 分块间的重叠量。小于等于 1.0 为比例，大于 1.0 为像素值。 |
| `grid_row` | - | INT | 2 | 1-10 | `grid` 模式下的行数。 |
| `grid_col` | - | INT | 2 | 1-10 | `grid` 模式下的列数。 |
| `divisible_by` | - | INT | 8 | 1-1024 | 确保分块尺寸是该数值的倍数（在预设/参考图模式下忽略）。 |

## 输出

| 输出名称 | 数据类型 | 描述 |
|---------|----------|------|
| `tile` | IMAGE | 分割后的图像分块批次。 |
| `tile_meta` | DICT | 包含分块位置、原始尺寸、重叠信息等元数据，用于后续图像重建。 |
| `bbox_mask` | MASK | 与 `tile` 一一对应的遮罩批次；每个遮罩在原图尺寸上标记该 tile 的裁剪区域（裁剪区域为 1，其余为 0）。 |

## 功能说明

- **灵活的分割模式**：
  - `auto`：自动计算最佳网格布局，目标是每个分块接近 1024px。
  - `grid`：手动指定行数和列数。
  - **预设**：从预定义的分辨率列表中选择（如 "1024x1024"）。
  - **参考图像**：使用另一张图像（`get_tile_size`）的尺寸作为分块尺寸。
- **重叠处理**：支持按比例（如 0.05 代表 5%）或绝对像素值设置重叠区域。
- **尺寸约束**：`divisible_by` 确保在 auto/grid 模式下分块尺寸符合模型要求（如 8 或 64 的倍数）。
- **精确计算**：计算精确的裁剪坐标，确保全覆盖和无缝合并。

## 注意与建议

- **参考图优先级**：如果连接了 `get_tile_size`，它将优先于 `mode` 选项生效。
- **预设行为**：预设分辨率与参考图像尺寸保持固定；`divisible_by` 在 `auto/grid` 模式下用于对齐尺寸。
- **图像重建**：`tile_meta` 输出对于 `Image Tile Merge` 节点正确重建原始图像至关重要。
