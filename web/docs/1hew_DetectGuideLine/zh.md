# Detect Guide Line - 引导线检测（消失点估计）

**节点功能：** `Detect Guide Line` 检测线段、通过交点聚类估计消失点，并从线段端点向消失点绘制引导线。输出带标注的图像、仅线图像与二值遮罩。

## 输入

| 参数名称 | 入端选择 | 数据类型 | 默认值 | 取值范围 | 描述 |
| -------- | -------- | -------- | ------ | -------- | ---- |
| `image` | - | IMAGE | - | - | 输入图像批次 |
| `canny_low` | - | FLOAT | 0.2 | 0.0-1.0 | Canny 低阈值（按 0–255 缩放） |
| `canny_high` | - | FLOAT | 0.8 | 0.0-1.0 | Canny 高阈值；自动与低阈值一致或更高 |
| `seg_min_len` | - | INT | 40 | 1-300 | Hough 最小线段长度（`minLineLength`） |
| `seg_max_gap` | - | INT | 8 | 1-100 | Hough 最大线段间隙（`maxLineGap`） |
| `guide_filter` | - | FLOAT | 0.6 | 0.1-1.0 | 线段筛选强度（基于百分位） |
| `guide_width` | - | INT | 2 | 1-100 | 绘制线宽（像素） |
| `cluster_eps` | - | INT | 30 | 1-100 | DBSCAN `eps`（交点聚类半径） |

## 输出

| 输出名称 | 数据类型 | 描述 |
|---------|----------|------|
| `image` | IMAGE | 带红色引导线与消失点标注的图像 |
| `line_image` | IMAGE | 黑底仅线图像，包含消失点 |
| `line_mask` | MASK | 引导线与消失点的二值遮罩（`B×H×W`） |

## 功能说明

- 边缘检测：对灰度高斯模糊后执行 Canny；使用 HoughLinesP 获取线段。
- 消失点估计：对线段延长后计算两两交点，使用 DBSCAN 聚类选取主消失点。
- 线段筛选：依据与消失点方向的对齐程度为线段打分；由 `guide_filter` 控制百分位阈值。
- 渲染输出：从每个端点向消失点绘制引导线，并在消失点处绘制红色圆点。
- 批量异步：逐帧处理在线程中执行，并根据 CPU 数量限制并发。

## 典型用法

- 强调透视线并估计消失点，用于构图参考与后续几何处理。
- 提高 `seg_min_len` 或降低 `seg_max_gap` 以减少短小/噪声线段。
- 根据图像尺寸调节 `cluster_eps`，使交点聚类更稳定。

## 注意与建议

- 当未检测到线段或交点时，仍输出合法张量（为零值）。
- `guide_filter` 控制选择百分位，数值越大越严格，仅保留更对齐的线段。