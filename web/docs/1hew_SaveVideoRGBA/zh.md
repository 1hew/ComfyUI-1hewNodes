# Save Video RGBA - 支持透明通道的视频保存

**节点功能：** `Save Video RGBA` 将图像批次保存为视频，支持 RGB 与 RGBA 输入。它保证输出尺寸满足 2 的倍数、自动选择适合透明通道的容器与编码器，并在界面返回预览。存在透明通道时，会生成 `webm` 预览，并在输出目录写入 `mov`（ProRes 4444）。

## 输入

| 参数名称 | 入端选择 | 数据类型 | 默认值 | 取值范围 | 描述 |
| -------- | -------- | -------- | ------ | -------- | ---- |
| `images` | - | IMAGE | - | - | 图像批次 `B×H×W×C`（`C=3/4`）。 |
| `fps` | - | FLOAT | `24.0` | `1.0–120.0`（步长 `1.0`） | 输出帧率。 |
| `filename_prefix` | - | STRING | `video/ComfyUI` | - | 保存路径前缀；支持由框架处理的格式占位符。 |
| `only_preview` | - | BOOLEAN | `False` | - | 开启后仅生成临时预览文件。 |
| `audio` | 可选 | AUDIO | - | - | 音频轨道；`webm` 使用 `libopus`，`mp4/mov` 使用 `aac`。 |

## 输出

| 输出名称 | 数据类型 | 描述 |
|---------|----------|------|
| - | - | 输出节点；返回包含保存结果信息的界面预览元素。 |

## 功能说明

- 尺寸整除保证：当宽或高不满足 2 的倍数时，使用 LANCZOS 下采样到最近的可编码尺寸。
- 透明通道工作流：存在透明通道时，预览采用 `webm` + `libvpx-vp9`，正式导出采用 `mov` + `prores_ks`（ProRes 4444，`yuva444p10le`）。无透明通道时默认 `mp4` + `h264`。
- 像素格式选择：VP9 使用 `yuva420p`；ProRes 透明使用 `yuva444p10le`；RGB 输出使用 `yuv420p`。
- 路径与命名：通过 `get_save_image_path` 计算目录、基本名与计数器；文件名模式为 `{base}_{counter:05}_.{ext}`。
- 异步保存：编码在工作线程执行，并返回 `PreviewVideo` 以展示保存条目。
- 音频复用：按帧数裁剪并复用音轨；依据通道数采用 `mono`/`stereo` 布局。

## 典型用法

- 保留透明：输入 RGBA 批次；预览生成 `webm`（支持透明），输出目录包含适用于专业流程的 `mov`。
- 仅预览导出：启用 `only_preview` 生成临时视频，便于快速检查与对比。
- 有序命名：依赖自增计数器在 `filename_prefix` 指定目录下组织批量导出。

## 注意与建议

- 透明通道流程：预览侧选择 `webm` 以适配浏览器展示；正式导出采用 ProRes 4444，适合高保真后期环节。
- 音频时长对齐：提供音频时，会按指定 `fps` 对齐并裁剪至视频时长。
- 数据布局与范围：输入为末通道张量；编码前按 `[0,1]` 浮点范围进行裁剪与 8 位转换。