# Image Edge Crop/Pad - 图像边缘裁剪与智能填充

**节点功能：** `Image Edge Crop/Pad` 支持按边进行向内裁剪（负值）与向外填充（正值），并提供统一模式（`uniform_amount`）用于对四边进行对称处理。可选择多种填充策略（`extend`、`mirror`、`edge`、`average`）与丰富颜色格式，同时通过 `divisible_by` 保证数值按倍数对齐。

## 输入

| 参数名称 | 入端选择 | 数据类型 | 默认值 | 取值范围 | 描述 |
| -------- | -------- | -------- | ------ | -------- | ---- |
| `image` | - | IMAGE | - | - | 输入图像批次（`B×H×W×C`）。 |
| `uniform_amount` | - | FLOAT | 0.0 | -8192–8192 | 统一裁剪/填充量；`<1` 视为尺寸比例；负值裁剪、正值填充。 |
| `top_amount` | - | FLOAT | 0.0 | -8192–8192 | 顶边裁剪/填充值；`<1` 视为高度比例。 |
| `bottom_amount` | - | FLOAT | 0.0 | -8192–8192 | 底边裁剪/填充值；`<1` 视为高度比例。 |
| `left_amount` | - | FLOAT | 0.0 | -8192–8192 | 左边裁剪/填充值；`<1` 视为宽度比例。 |
| `right_amount` | - | FLOAT | 0.0 | -8192–8192 | 右边裁剪/填充值；`<1` 视为宽度比例。 |
| `pad_color` | - | STRING | `0.0` | 多种格式 | 填充颜色/策略：灰度 / HEX / RGB / 颜色名 或 `extend`/`mirror`/`edge`/`average`（支持缩写）。 |
| `divisible_by` | - | INT | 8 | 1–1024 | 将各边数值按该倍数取整对齐，确保尺寸对齐。 |

## 输出

| 输出名称 | 数据类型 | 描述 |
|---------|----------|------|
| `image` | IMAGE | 执行裁剪/填充后的图像批次。 |
| `mask` | MASK | 编辑区域的二值遮罩；被处理区域为白色，原图区域为黑色。 |

## 功能说明

- 边缘精细控制：`uniform_amount` 与四边独立参数组合实现精确编辑。
- 比例或像素：`<1` 视为比例，否则按像素处理。
- 尺寸对齐：各边数值按 `divisible_by` 的倍数量化，满足模型输入约束。
- 填充策略：
  - `extend`：复制边缘像素（`replicate`）。
  - `mirror`：镜像边缘像素（`reflect`，对大填充量分段扩展）。
  - `edge`：按四边平均色填充（分别取顶/底/左/右边平均）。
  - `average`：按整图平均色填充。
- 颜色格式：灰度（`0.0`–`1.0`）、HEX（`#RRGGBB` 或 `RGB`）、RGB（`255,0,0` 或 `1.0,0.0,0.0`）、颜色名；支持单字母别名。

## 遮罩规则

- 仅裁剪：遮罩以白色标记被裁剪区域，原图区域为黑色。
- 仅填充：遮罩与输出尺寸一致；填充区域为白色，原始内容区域为黑色。
- 混合编辑：遮罩以白色表达所有被处理区域（裁剪 + 填充）。
- 全零参数：返回原图与全黑遮罩。

## 典型用法

- 统一向内裁剪 10%：设置 `uniform_amount=-0.1`，四边参数保持 `0.0`。
- 每边向外填充 32 像素并镜像填充：设置 `uniform_amount=32`、`pad_color=mirror`、`divisible_by=8`。
- 内容感知填充：设置 `pad_color=edge` 或 `average` 以协调边界颜色。
- 非对称编辑：结合四边参数与 `uniform_amount` 实现复杂的边缘处理。

## 注意与建议

- 负值表示向内裁剪；正值表示向外填充；比例值相对宽/高计算。
- 推荐使用 `divisible_by` 保持输出尺寸与模型要求对齐（例如 8 或 16）。
- 使用 `mirror` 时，大填充量将分段应用以满足 `reflect` 的边界条件。